<!DOCTYPE html>
<html lang="id" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisis Kriptografi S-Box</title>
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <link rel="stylesheet" href="/static/style.css">

    <!-- Enable dark mode in tailwind config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header Section with controls -->
        <header class="text-center mb-12 flex flex-col sm:flex-row justify-between items-center">
            <div>
                <h1 class="text-4xl font-bold text-gray-800 dark:text-gray-200 mb-2">Analisis Kriptografi S-Box</h1>
                <p class="text-lg text-gray-600 dark:text-gray-300">Metrik dan analisis visual untuk kotak substitusi</p>
            </div>

            <!-- Dark Mode Toggle -->
            <div class="flex space-x-4 mt-4 sm:mt-0">
                <button id="themeToggle" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 transition-colors duration-200 hover:bg-gray-300 dark:hover:bg-gray-600">
                    <svg id="themeIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Introduction Card -->
        <section class="mb-10">
            <details class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden">
                <summary class="cursor-pointer px-6 py-4 bg-blue-50 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 font-medium flex justify-between items-center">
                    <span>Apa itu S-Box? Pelajari Dasar-dasar Kriptografi</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </summary>
                <div class="p-6">
                    <p class="mb-4">S-Box (Substitution Box) adalah komponen fundamental dalam banyak algoritma kriptografi, termasuk AES (Advanced Encryption Standard). Ini pada dasarnya adalah tabel pencarian yang melakukan substitusi.</p>

                    <p class="mb-4">S-Box digunakan untuk memperkenalkan nonlinearitas dalam sistem kriptografi, membuatnya tahan terhadap kriptanalisis linier dan diferensial.</p>

                    <h3 class="font-semibold text-lg mb-2">Mengapa Mengukur Properti Kriptografi?</h3>
                    <ul class="list-disc pl-6 mb-4 space-y-2">
                        <li><strong>Nonlinearitas (NL)</strong>: Mengukur ketahanan terhadap kriptanalisis linier</li>
                        <li><strong>Kriteria Avalanche Ketat (SAC)</strong>: Memastikan perubahan kecil pada input mempengaruhi ~50% bit output</li>
                        <li><strong>Kriteria Kemandirian Bit (BIC)</strong>: Memeriksa apakah bit-bit output berperilaku secara independen</li>
                        <li><strong>Uniformitas Diferensial (DU)</strong>: Mengukur ketahanan terhadap serangan diferensial</li>
                        <li><strong>Probabilitas Pendekatan Linear (LAP)</strong>: Menilai bias linear dalam S-box</li>
                    </ul>

                    <p>Metrik-metrik ini membantu mengevaluasi seberapa aman sebuah S-box terhadap berbagai metode serangan.</p>
                </div>
            </details>
        </section>

        <!-- S-Box Selection Section -->
        <section class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-10 transition-all duration-300 hover:shadow-xl">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-6 flex items-center">
                <svg class="w-6 h-6 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
                </svg>
                Analisis S-Box Anda
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6">
                <!-- Predefined S-box Selection -->
                <div class="bg-gray-50 dark:bg-gray-700/50 p-5 rounded-xl">
                    <label for="sbox-select" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        Pilih S-Box Bawaan
                    </label>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <select id="sbox-select" class="flex-grow p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200">
                            <option value="">Pilih S-Box...</option>
                        </select>
                        <button id="load-sbox-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg transition duration-200 font-medium whitespace-nowrap">
                            Muat S-Box
                        </button>
                    </div>
                </div>

                <!-- Custom S-box Input -->
                <div class="bg-gray-50 dark:bg-gray-700/50 p-5 rounded-xl">
                    <label for="custom-sbox" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        Atau Masukkan S-Box Kustom
                    </label>
                    <p class="text-gray-600 dark:text-gray-400 mb-3 text-sm">Masukkan 256 bilangan bulat antara 0 dan 255, dipisahkan koma:</p>
                    <textarea
                        id="custom-sbox"
                        rows="4"
                        class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200"
                        placeholder="contoh: 99,224,149,199,47,218,49,104,... (256 nilai)">
                    </textarea>
                </div>
            </div>

            <!-- Compute Button -->
            <div class="text-center mt-8">
                <button
                    id="compute-btn"
                    class="bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white px-8 py-4 rounded-xl text-lg font-bold transition-all duration-300 shadow-lg hover:shadow-2xl transform hover:-translate-y-1 focus:outline-none focus:ring-4 focus:ring-green-400/30">
                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                    </svg>
                    Hitung Metrik Kriptografi
                </button>
            </div>
        </section>

        <!-- Results Section -->
        <div id="results" class="space-y-10">
            <!-- Results will be loaded here -->
        </div>

        <!-- Encryption/Decryption Section -->
        <section class="mt-12 bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 transition-all duration-300 hover:shadow-xl">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-6 flex items-center">
                <svg class="w-6 h-6 mr-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                Enkripsi & Dekripsi Teks
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Input Section -->
                <div class="space-y-6">
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                        <label for="encrypt-sbox-select" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            Pilih S-Box untuk Enkripsi/Dekripsi
                        </label>
                        <select id="encrypt-sbox-select" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200">
                            <option value="">Pilih S-Box...</option>
                        </select>
                    </div>

                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                        <label for="encrypt-key" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                            </svg>
                            Kunci (Password)
                        </label>
                        <input
                            type="password"
                            id="encrypt-key"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200"
                            placeholder="Masukkan kunci enkripsi/dekripsi"
                        >
                    </div>

                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                        <label for="plaintext-input" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Teks Asli (Plaintext)
                        </label>
                        <textarea
                            id="plaintext-input"
                            rows="6"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200"
                            placeholder="Masukkan teks yang akan dienkripsi...">
                        </textarea>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-3">
                        <button
                            id="encrypt-btn"
                            class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white px-6 py-3 rounded-lg text-lg font-bold transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                            Enkripsi
                        </button>
                        <button
                            id="decrypt-btn"
                            class="flex-1 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white px-6 py-3 rounded-lg text-lg font-bold transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"></path>
                            </svg>
                            Dekripsi
                        </button>
                    </div>
                </div>

                <!-- Output Section -->
                <div class="space-y-6">
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                        <label for="ciphertext-output" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Teks Terenkripsi (Ciphertext)
                        </label>
                        <textarea
                            id="ciphertext-output"
                            rows="6"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200"
                            placeholder="Hasil enkripsi akan muncul di sini..."
                            readonly>
                        </textarea>
                        <div class="mt-2 flex justify-end">
                            <button
                                id="copy-ciphertext-btn"
                                class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg text-sm font-medium transition duration-200 flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                                Salin
                            </button>
                        </div>
                    </div>

                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                        <label for="decrypted-output" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                            Teks Didekripsi (Plaintext)
                        </label>
                        <textarea
                            id="decrypted-output"
                            rows="6"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200"
                            placeholder="Hasil dekripsi akan muncul di sini..."
                            readonly>
                        </textarea>
                        <div class="mt-2 flex justify-end">
                            <button
                                id="copy-decrypted-btn"
                                class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg text-sm font-medium transition duration-200 flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                                Salin
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Image Encryption/Decryption Section -->
        <section class="mt-12 bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 transition-all duration-300 hover:shadow-xl">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-6 flex items-center">
                <svg class="w-6 h-6 mr-2 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                Enkripsi & Dekripsi Gambar
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Input Section -->
                <div class="space-y-6">
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                        <label for="image-encrypt-sbox-select" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            Pilih S-Box untuk Enkripsi/Dekripsi Gambar
                        </label>
                        <select id="image-encrypt-sbox-select" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200">
                            <option value="">Pilih S-Box...</option>
                        </select>
                    </div>

                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                        <label for="image-encrypt-key" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                            </svg>
                            Kunci (Password)
                        </label>
                        <input
                            type="password"
                            id="image-encrypt-key"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200"
                            placeholder="Masukkan kunci enkripsi/dekripsi gambar"
                        >
                    </div>

                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                        <label for="image-input" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                            </svg>
                            Unggah Gambar
                        </label>
                        <div class="flex items-center justify-center w-full">
                            <label for="image-input" class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-xl cursor-pointer bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-300 hover:border-blue-500">
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <svg class="w-10 h-10 mb-4 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                    </svg>
                                    <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">Klik untuk mengunggah</span> atau seret dan lepas</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">PNG, JPG, JPEG (MAX. 5MB)</p>
                                </div>
                                <input id="image-input" type="file" class="hidden" accept="image/*" />
                            </label>
                        </div>
                        <p id="image-filename" class="mt-2 text-sm text-gray-500 dark:text-gray-400 text-center"></p>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-3">
                        <button
                            id="image-encrypt-btn"
                            class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white px-6 py-3 rounded-lg text-lg font-bold transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                            Enkripsi Gambar
                        </button>
                        <button
                            id="image-decrypt-btn"
                            class="flex-1 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white px-6 py-3 rounded-lg text-lg font-bold transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"></path>
                            </svg>
                            Dekripsi Gambar
                        </button>
                    </div>
                </div>

                <!-- Output Section -->
                <div class="space-y-6">
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                        <label class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            Pratinjau Gambar
                        </label>
                        <div class="flex flex-col items-center justify-center">
                            <div class="w-full h-64 bg-gray-100 dark:bg-gray-700 rounded-xl overflow-hidden flex items-center justify-center border border-gray-200 dark:border-gray-600">
                                <img id="original-image-preview" src="" alt="Pratinjau Gambar Asli" class="max-h-full max-w-full object-contain hidden">
                                <div id="original-image-placeholder" class="text-center text-gray-500 dark:text-gray-400 p-4">
                                    <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <p>Pratinjau gambar asli akan muncul di sini</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                        <label class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                            Pratinjau Hasil
                        </label>
                        <div class="flex flex-col items-center justify-center">
                            <div class="w-full h-64 bg-gray-100 dark:bg-gray-700 rounded-xl overflow-hidden flex items-center justify-center border border-gray-200 dark:border-gray-600">
                                <img id="result-image-preview" src="" alt="Pratinjau Hasil" class="max-h-full max-w-full object-contain hidden">
                                <div id="result-image-placeholder" class="text-center text-gray-500 dark:text-gray-400 p-4">
                                    <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <p>Hasil enkripsi/dekripsi akan muncul di sini</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2 flex justify-end">
                            <button
                                id="download-result-btn"
                                class="bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300 shadow hidden flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                </svg>
                                Unduh Hasil
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Metric Explanations Section -->
        <section class="mt-12">
            <details class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden transition-all duration-300">
                <summary class="cursor-pointer px-6 py-4 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/30 dark:to-purple-900/30 text-indigo-800 dark:text-indigo-200 font-bold flex justify-between items-center rounded-2xl">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-3 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Bagaimana Metrik-Metrik Ini Bekerja</span>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-indigo-500" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </summary>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500">
                                <h3 class="font-bold text-lg mb-2 text-blue-600 dark:text-blue-400 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    Nonlinearitas (NL)
                                </h3>
                                <p class="text-gray-700 dark:text-gray-300">Mengukur seberapa jauh S-Box dari fungsi linear manapun. Nilai yang lebih tinggi menunjukkan ketahanan yang lebih kuat terhadap kriptanalisis linier. Untuk S-Box 8x8, nilai maksimum teoritis adalah 120.</p>
                            </div>

                            <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">
                                <h3 class="font-bold text-lg mb-2 text-green-600 dark:text-green-400 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                                    </svg>
                                    Kriteria Avalanche Ketat (SAC)
                                </h3>
                                <p class="text-gray-700 dark:text-gray-300">Mengukur probabilitas bahwa pembalikan satu bit input mengubah setiap bit output. Nilai ideal adalah 0.5, artinya bit output berubah secara independen dengan probabilitas 50%.</p>
                            </div>

                            <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border-l-4 border-purple-500">
                                <h3 class="font-bold text-lg mb-2 text-purple-600 dark:text-purple-400 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                    </svg>
                                    Kriteria Kemandirian Bit (BIC)
                                </h3>
                                <p class="text-gray-700 dark:text-gray-300">Memeriksa apakah bit-bit output berperilaku secara independen satu sama lain. Nilai tinggi menunjukkan properti independensi yang baik.</p>
                            </div>

                            <div class="p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border-l-4 border-red-500">
                                <h3 class="font-bold text-lg mb-2 text-red-600 dark:text-red-400 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                    </svg>
                                    Uniformitas Diferensial (DU)
                                </h3>
                                <p class="text-gray-700 dark:text-gray-300">Mengukur ketahanan terhadap kriptanalisis diferensial. Nilai yang lebih rendah menunjukkan keamanan yang lebih baik. Nilai ideal adalah 2.</p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500">
                                <h3 class="font-bold text-lg mb-2 text-yellow-600 dark:text-yellow-400 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Probabilitas Pendekatan Linear (LAP)
                                </h3>
                                <p class="text-gray-700 dark:text-gray-300">Menilai bias linear dalam S-box. Nilai yang lebih rendah menunjukkan ketahanan yang lebih baik terhadap serangan linier. Nilai ideal mendekati 0.</p>
                            </div>

                            <div class="p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg border-l-4 border-indigo-500">
                                <h3 class="font-bold text-lg mb-2 text-indigo-600 dark:text-indigo-400 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    Tabel Distribusi Diferensial (DAP)
                                </h3>
                                <p class="text-gray-700 dark:text-gray-300">Menampilkan probabilitas maksimum dalam tabel distribusi diferensial. Nilai yang lebih rendah menunjukkan ketahanan yang lebih baik terhadap serangan diferensial.</p>
                            </div>

                            <div class="p-4 bg-teal-50 dark:bg-teal-900/20 rounded-lg border-l-4 border-teal-500">
                                <h3 class="font-bold text-lg mb-2 text-teal-600 dark:text-teal-400 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path>
                                    </svg>
                                    Indikator Absolut (AD)
                                </h3>
                                <p class="text-gray-700 dark:text-gray-300">Berhubungan dengan nonlinearitas S-Box. Nilai-nilai yang lebih tinggi biasanya menunjukkan properti kriptografi yang lebih kuat.</p>
                            </div>

                            <div class="p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg border-l-4 border-amber-500">
                                <h3 class="font-bold text-lg mb-2 text-amber-600 dark:text-amber-400 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                    </svg>
                                    Tingkat Transparansi (TO)
                                </h3>
                                <p class="text-gray-700 dark:text-gray-300">Mengukur ketahanan terhadap serangan sisi saluran (side-channel). Nilai-nilai yang lebih tinggi menunjukkan ketahanan yang lebih baik terhadap analisis korelasi kekuatan orde pertama.</p>
                            </div>

                            <div class="p-4 bg-pink-50 dark:bg-pink-900/20 rounded-lg border-l-4 border-pink-500">
                                <h3 class="font-bold text-lg mb-2 text-pink-600 dark:text-pink-400 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Imunitas Korelasi (CI)
                                </h3>
                                <p class="text-gray-700 dark:text-gray-300">Mengukur ketahanan terhadap serangan korelasi. Nilai-nilai yang lebih tinggi menunjukkan kekuatan kriptografi yang lebih baik.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </details>
        </section>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-white/80 backdrop-blur-sm flex flex-col items-center justify-center z-50">
        <div class="h-10 w-10 border-4 border-blue-400 border-t-transparent rounded-full animate-spin"></div>
        <p id="loadingMessage" class="mt-4 text-gray-700 text-lg font-medium"></p>
    </div>

    <script>
        // Load available S-boxes on page load
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/api/sboxes')
                .then(response => response.json())
                .then(sboxes => {
                    const selectElement = document.getElementById('sbox-select');
                    sboxes.forEach(sbox => {
                        const option = document.createElement('option');
                        option.value = sbox.id;
                        option.textContent = `${sbox.name} (${sbox.source})`;
                        selectElement.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading S-boxes:', error);
                });

            // Set up the compute button to send the current S-box
            document.getElementById('compute-btn').addEventListener('click', function() {
                // Get the selected S-box or custom input
                const customInput = document.getElementById('custom-sbox').value.trim();

                if (!customInput) {
                    alert('Please enter an S-box in the custom input field.');
                    return;
                }

                try {
                    // Parse the custom input
                    let sboxToUse = customInput.split(',').map(item => parseInt(item.trim()));

                    if (sboxToUse.length !== 256) {
                        alert(`Invalid S-box: Expected 256 values, got ${sboxToUse.length}`);
                        return;
                    }

                    // Validate that all values are between 0 and 255
                    for (let val of sboxToUse) {
                        if (isNaN(val) || val < 0 || val > 255) {
                            alert(`Invalid value: ${val}. All values must be integers between 0 and 255.`);
                            return;
                        }
                    }

                    // Show loading overlay
                    showLoadingOverlay();
                    startEducationalMessages();
                    showSkeleton();
                    disableComputeButton();

                    // Send the request to the API
                    fetch('/api/compute', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({sbox: sboxToUse})
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.ok) {
                            displayResults(data.metrics);
                        } else {
                            document.getElementById('results').innerHTML =
                                `<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg text-center">Error: ${data.error}</div>`;
                        }

                        // Hide loading elements
                        hideLoadingOverlay();
                        hideSkeleton();
                        enableComputeButton();
                    })
                    .catch(error => {
                        document.getElementById('results').innerHTML =
                            `<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg text-center">Error: ${error.message}</div>`;

                        // Hide loading elements
                        hideLoadingOverlay();
                        hideSkeleton();
                        enableComputeButton();
                    });

                } catch (e) {
                    document.getElementById('results').innerHTML =
                        `<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg text-center">Error: ${e.message}</div>`;

                    // Hide loading elements
                    hideLoadingOverlay();
                    hideSkeleton();
                    enableComputeButton();
                }
            });

            // Update the load-sbox-btn to populate the textarea with selected S-box
            document.getElementById('load-sbox-btn').addEventListener('click', function() {
                const selectedSboxId = document.getElementById('sbox-select').value;
                if (!selectedSboxId) {
                    alert('Please select an S-box first.');
                    return;
                }

                // Fetch the specific S-box data
                fetch(`/api/sbox/${selectedSboxId}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('custom-sbox').value = data.sbox.join(',');
                    })
                    .catch(error => {
                        console.error('Error loading S-box content:', error);
                        alert('Error loading S-box content. Please try again.');
                    });
            });
        });

        // Function to display results in a nice format
        function displayResults(metrics) {
            // Determine overall score based on metrics
            let overallScore = "Moderate";
            let scoreColor = "bg-yellow-100 dark:bg-yellow-900/30 border-yellow-400 dark:border-yellow-700";
            let scoreDescription = "S-Box ini memiliki properti kriptografi sedang.";
            let overallScoreText = "S-Box Sedang";

            // Evaluate based on key metrics
            if (metrics.NL >= 100 && metrics.SAC >= 0.48 && metrics.DU <= 8) {
                overallScore = "Strong";
                scoreColor = "bg-green-100 dark:bg-green-900/30 border-green-400 dark:border-green-700";
                scoreDescription = "S-Box ini menunjukkan properti kriptografi yang kuat dan ketahanan tinggi terhadap serangan yang diketahui.";
                overallScoreText = "S-Box Kuat";
            } else if (metrics.NL >= 80 && metrics.SAC >= 0.45 && metrics.DU <= 16) {
                overallScore = "Good";
                scoreColor = "bg-blue-100 dark:bg-blue-900/30 border-blue-400 dark:border-blue-700";
                scoreDescription = "S-Box ini memiliki properti kriptografi yang bagus dengan ketahanan yang layak terhadap sebagian besar serangan.";
                overallScoreText = "S-Box Baik";
            } else if (metrics.NL < 60 || metrics.DU > 32) {
                overallScore = "Weak";
                scoreColor = "bg-red-100 dark:bg-red-900/30 border-red-400 dark:border-red-700";
                scoreDescription = "S-Box ini memiliki properti kriptografi yang lemah dan ketahanan rendah terhadap serangan.";
                overallScoreText = "S-Box Lemah";
            }

            // Create the summary card
            const summaryCard = `
            <section class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4">Ringkasan Analisis</h2>
                <div class="p-6 ${scoreColor} border rounded-xl shadow-sm">
                    <div class="flex flex-col items-center justify-center text-center">
                        <h3 class="text-3xl font-bold mb-2">
                            ${overallScoreText}
                            <span class="inline-block ml-3 px-3 py-1 rounded-full text-sm font-semibold ${overallScore === "Strong" ? "bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200" : overallScore === "Good" ? "bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200" : overallScore === "Moderate" ? "bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200" : "bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200"}">Skor Kualitas</span>
                        </h3>
                        <div class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-4">
                            Nonlinearitas: ${metrics.NL.toFixed(2)}, SAC: ${metrics.SAC.toFixed(6)}, DU: ${metrics.DU}
                        </div>
                        <p class="text-gray-700 dark:text-gray-300 max-w-2xl">${scoreDescription}</p>
                    </div>
                </div>
            </section>`;

            // Generate metrics grid with skeleton and fade-in animation
            let metricsGrid = `
            <section class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-6">Metrik Terperinci</h2>
                <div id="metricsSkeleton" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-6 animate-pulse">
                    <div class="h-32 bg-gray-200 dark:bg-gray-700 rounded-xl"></div>
                    <div class="h-32 bg-gray-200 dark:bg-gray-700 rounded-xl"></div>
                    <div class="h-32 bg-gray-200 dark:bg-gray-700 rounded-xl"></div>
                    <div class="h-32 bg-gray-200 dark:bg-gray-700 rounded-xl"></div>
                    <div class="h-32 bg-gray-200 dark:bg-gray-700 rounded-xl"></div>
                    <div class="h-32 bg-gray-200 dark:bg-gray-700 rounded-xl"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 transition-opacity duration-500 opacity-0" id="metricsGrid">`;

            for (const [key, value] of Object.entries(metrics)) {
                let valueType = typeof value;
                let displayValue = value;

                // Format values appropriately
                if (valueType === 'number') {
                    if (key === 'SAC') {
                        displayValue = value.toFixed(6);
                    } else {
                        displayValue = value.toFixed(key === 'NL' ? 2 : 4);
                    }
                }

                // Get explanation for each metric from explanations
                let explanation = getMetricExplanation(key);

                metricsGrid += `
                    <div class="p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200">
                        <h3 class="font-semibold text-lg text-gray-800 dark:text-gray-200 mb-2">${key}</h3>
                        <div class="text-3xl font-bold ${key === 'NL' && value >= 100 ? 'text-green-600 dark:text-green-400' : key === 'SAC' && value >= 0.48 ? 'text-green-600 dark:text-green-400' : key === 'DU' && value <= 8 ? 'text-green-600 dark:text-green-400' : key === 'DU' && value > 32 ? 'text-red-600 dark:text-red-400' : 'text-blue-600 dark:text-blue-400'}">${displayValue}</div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-3">${explanation}</p>
                    </div>`;
            }

            metricsGrid += `</div></section>`;

            // Add visualization section
            const visualizationSection = `
            <section class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-6">Visualisasi</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
                        <h3 class="font-medium text-lg text-gray-800 dark:text-gray-200 mb-4 text-center">Ikhtisar Metrik Kriptografi</h3>
                        <canvas id="radarChart" width="400" height="400"></canvas>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
                        <h3 class="font-medium text-lg text-gray-800 dark:text-gray-200 mb-4 text-center">Distribusi SAC</h3>
                        <canvas id="sacChart" width="400" height="400"></canvas>
                    </div>
                </div>
            </section>`;

            // Combine all sections
            document.getElementById('results').innerHTML = summaryCard + metricsGrid + visualizationSection;

            // Fade in the metric cards after a short delay
            setTimeout(() => {
                document.getElementById('metricsGrid').classList.remove('opacity-0');
            }, 100);

            // Render charts if Chart.js and app.js are available
            if (typeof Chart !== 'undefined') {
                // Check if chart functions are available, otherwise wait for them to load
                if (typeof renderRadarChart !== 'undefined' && typeof renderSacChart !== 'undefined') {
                    // Normalize metrics for radar chart
                    const normalizedMetrics = normalizeMetricsForChart(metrics);
                    renderRadarChart(normalizedMetrics);

                    // Render SAC chart
                    renderSacChart(metrics.SAC);
                } else {
                    // If functions aren't available yet, set a short timeout to try again
                    setTimeout(function() {
                        if (typeof renderRadarChart !== 'undefined' && typeof renderSacChart !== 'undefined') {
                            const normalizedMetrics = normalizeMetricsForChart(metrics);
                            renderRadarChart(normalizedMetrics);
                            renderSacChart(metrics.SAC);
                        } else {
                            console.error('Chart functions are not available after timeout');
                        }
                    }, 100);
                }
            }
        }

        // Helper function to get metric explanations
        function getMetricExplanation(key) {
            const explanations = {
                'NL': 'Nonlinearitas mengukur ketahanan terhadap kriptanalisis linier. Semakin tinggi semakin baik.',
                'SAC': 'Kriteria Avalanche Ketat mengukur kemandirian bit. Nilai ideal adalah 0.5.',
                'BIC_NL': 'Kriteria Kemandirian Bit (Nonlinearitas) memeriksa kemandirian bit output.',
                'BIC_SAC': 'Kriteria Kemandirian Bit (SAC) mengevaluasi kemandirian efek avalanche.',
                'LAP': 'Probabilitas Pendekatan Linear menilai bias linear. Semakin rendah semakin baik.',
                'DAP': 'Probabilitas Pendekatan Diferensial mengukur bias diferensial. Semakin rendah semakin baik.',
                'DU': 'Uniformitas Diferensial menunjukkan ketahanan terhadap serangan diferensial. Semakin rendah semakin baik.',
                'AD': 'Indikator Absolut berhubungan dengan nonlinearitas. Nilai-nilai yang lebih tinggi menunjukkan properti yang lebih kuat.',
                'TO': 'Tingkat Transparansi mengukur ketahanan terhadap serangan sisi saluran. Semakin tinggi semakin baik.',
                'CI': 'Imunitas Korelasi mengukur ketahanan terhadap serangan korelasi. Semakin tinggi semakin baik.'
            };
            return explanations[key] || 'Pengukuran properti kriptografi.';
        }

        // Function to normalize metrics for radar chart
        function normalizeMetricsForChart(metrics) {
            // Define ideal values or max values for normalization
            const idealMaxValues = {
                'NL': 120,
                'SAC': 1,
                'BIC_NL': 120,
                'BIC_SAC': 0.5,
                'LAP': 0.25, // Max possible value
                'DAP': 0.25,
                'DU': 2, // Theoretical minimum
                'AD': 100, // Reference value
                'TO': 1, // Reference value
                'CI': 1 // Reference value
            };

            const normalized = {};
            for (const [key, value] of Object.entries(metrics)) {
                // For metrics where lower is better, invert the value
                if (['LAP', 'DAP', 'DU'].includes(key)) {
                    normalized[key] = 1 - Math.min(value / idealMaxValues[key], 1);
                } else {
                    // For metrics where higher is better
                    normalized[key] = Math.min(value / idealMaxValues[key], 1);
                }
            }
            return normalized;
        }

        // Theme Management
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');

            if (isDark) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                `;
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                `;
            }

            // Update charts theme if they exist
            if (typeof updateChartsTheme === 'function') {
                updateChartsTheme();
            }
        }

        // Set up theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            const html = document.documentElement;

            if (savedTheme === 'dark') {
                html.classList.add('dark');
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                `;
            } else {
                html.classList.remove('dark');
                document.getElementById('themeIcon').innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                `;
            }

            // Set up theme toggle button
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        });

        // Educational Loading Functions
        function showLoadingOverlay() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoadingOverlay() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function showSkeleton() {
            const skeleton = document.getElementById('metricsSkeleton');
            if (skeleton) {
                skeleton.classList.remove('hidden');
            }
        }

        function hideSkeleton() {
            const skeleton = document.getElementById('metricsSkeleton');
            if (skeleton) {
                skeleton.classList.add('hidden');
            }
        }

        function disableComputeButton() {
            const button = document.getElementById('compute-btn');
            if (button) {
                button.disabled = true;
                button.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        function enableComputeButton() {
            const button = document.getElementById('compute-btn');
            if (button) {
                button.disabled = false;
                button.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Function to start educational messages (will be updated by app.js)
        function startEducationalMessages() {
            if (window.startMessageRotation) {
                window.startMessageRotation();
            }
        }
    </script>

    <!-- HTMX Event Handlers -->
    <script>
        document.body.addEventListener("htmx:beforeRequest", () => {
            showLoadingOverlay();
            startEducationalMessages();
            showSkeleton();
            disableComputeButton();
        });

        document.body.addEventListener("htmx:afterOnLoad", () => {
            hideLoadingOverlay();
            hideSkeleton();
            enableComputeButton();
            // Add fade-in effect to results
            const metricsGrid = document.getElementById('metricsGrid');
            if (metricsGrid) {
                setTimeout(() => {
                    metricsGrid.classList.remove('opacity-0');
                }, 100);
            }
        });
    </script>

    <!-- Encryption/Decryption JavaScript -->
    <script>
        // Load available S-boxes for encryption/decryption section
        document.addEventListener('DOMContentLoaded', function() {
            // Load S-boxes for encryption/decryption dropdown
            fetch('/api/sboxes')
                .then(response => response.json())
                .then(sboxes => {
                    const selectElement = document.getElementById('encrypt-sbox-select');
                    sboxes.forEach(sbox => {
                        const option = document.createElement('option');
                        option.value = sbox.id;
                        option.textContent = `${sbox.name} (${sbox.source})`;
                        selectElement.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading S-boxes for encryption:', error);
                });

            // Set up encrypt button
            document.getElementById('encrypt-btn').addEventListener('click', function() {
                const plaintext = document.getElementById('plaintext-input').value;
                const key = document.getElementById('encrypt-key').value;
                const sboxId = document.getElementById('encrypt-sbox-select').value;

                if (!plaintext) {
                    alert('Silakan masukkan teks yang akan dienkripsi.');
                    return;
                }

                if (!key) {
                    alert('Silakan masukkan kunci enkripsi.');
                    return;
                }

                if (!sboxId) {
                    alert('Silakan pilih S-box untuk enkripsi.');
                    return;
                }

                // Show loading overlay
                showLoadingOverlay();

                // Send the request to the API
                fetch('/api/encrypt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        plaintext: plaintext,
                        key: key,
                        sbox_id: sboxId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.ok) {
                        document.getElementById('ciphertext-output').value = data.ciphertext;
                        document.getElementById('decrypted-output').value = ''; // Clear decrypted output
                    } else {
                        alert(`Error: ${data.error}`);
                    }

                    // Hide loading overlay
                    hideLoadingOverlay();
                })
                .catch(error => {
                    alert(`Error: ${error.message}`);
                    hideLoadingOverlay();
                });
            });

            // Set up decrypt button
            document.getElementById('decrypt-btn').addEventListener('click', function() {
                const ciphertext = document.getElementById('ciphertext-output').value;
                const key = document.getElementById('encrypt-key').value;
                const sboxId = document.getElementById('encrypt-sbox-select').value;

                if (!ciphertext) {
                    alert('Silakan masukkan ciphertext yang akan didekripsi (atau gunakan hasil enkripsi).');
                    return;
                }

                if (!key) {
                    alert('Silakan masukkan kunci dekripsi.');
                    return;
                }

                if (!sboxId) {
                    alert('Silakan pilih S-box untuk dekripsi.');
                    return;
                }

                // Show loading overlay
                showLoadingOverlay();

                // Send the request to the API
                fetch('/api/decrypt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ciphertext: ciphertext,
                        key: key,
                        sbox_id: sboxId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.ok) {
                        document.getElementById('decrypted-output').value = data.plaintext;
                    } else {
                        alert(`Error: ${data.error}`);
                    }

                    // Hide loading overlay
                    hideLoadingOverlay();
                })
                .catch(error => {
                    alert(`Error: ${error.message}`);
                    hideLoadingOverlay();
                });
            });

            // Set up copy ciphertext button
            document.getElementById('copy-ciphertext-btn').addEventListener('click', function() {
                const ciphertextOutput = document.getElementById('ciphertext-output');
                ciphertextOutput.select();
                document.execCommand('copy');

                // Show temporary feedback
                const originalText = this.textContent;
                this.textContent = 'Disalin!';
                setTimeout(() => {
                    this.textContent = originalText;
                }, 2000);
            });

            // Set up copy decrypted button
            document.getElementById('copy-decrypted-btn').addEventListener('click', function() {
                const decryptedOutput = document.getElementById('decrypted-output');
                decryptedOutput.select();
                document.execCommand('copy');

                // Show temporary feedback
                const originalText = this.textContent;
                this.textContent = 'Disalin!';
                setTimeout(() => {
                    this.textContent = originalText;
                }, 2000);
            });
        });
    </script>

    <!-- Load custom app.js for chart functions -->
    <script src="/static/app.js"></script>

    <!-- Image Encryption/Decryption JavaScript -->
    <script>
        // Image encryption/decryption functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Load S-boxes for image encryption/decryption dropdown
            fetch('/api/sboxes')
                .then(response => response.json())
                .then(sboxes => {
                    const selectElement = document.getElementById('image-encrypt-sbox-select');
                    sboxes.forEach(sbox => {
                        const option = document.createElement('option');
                        option.value = sbox.id;
                        option.textContent = `${sbox.name} (${sbox.source})`;
                        selectElement.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading S-boxes for image encryption:', error);
                });

            // Handle image file selection
            const imageInput = document.getElementById('image-input');
            const imageFilename = document.getElementById('image-filename');
            const originalImagePreview = document.getElementById('original-image-preview');
            const originalImagePlaceholder = document.getElementById('original-image-placeholder');

            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    imageFilename.textContent = file.name;

                    // Show preview of the original image
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        originalImagePreview.src = event.target.result;
                        originalImagePreview.classList.remove('hidden');
                        originalImagePlaceholder.classList.add('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    imageFilename.textContent = '';
                    originalImagePreview.classList.add('hidden');
                    originalImagePlaceholder.classList.remove('hidden');
                }
            });

            // Set up image encrypt button
            document.getElementById('image-encrypt-btn').addEventListener('click', function() {
                const imageFile = imageInput.files[0];
                const key = document.getElementById('image-encrypt-key').value;
                const sboxId = document.getElementById('image-encrypt-sbox-select').value;

                if (!imageFile) {
                    alert('Silakan pilih gambar yang akan dienkripsi.');
                    return;
                }

                if (!key) {
                    alert('Silakan masukkan kunci enkripsi.');
                    return;
                }

                if (!sboxId) {
                    alert('Silakan pilih S-box untuk enkripsi gambar.');
                    return;
                }

                // Show loading overlay
                showLoadingOverlay();

                // Create FormData for the request
                const formData = new FormData();
                formData.append('image', imageFile);
                formData.append('key', key);
                formData.append('sbox_id', sboxId);

                // Send the request to the API
                fetch('/api/image/encrypt', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (response.ok) {
                        return response.blob();
                    } else {
                        return response.json().then(data => {
                            throw new Error(data.error || 'Unknown error occurred');
                        });
                    }
                })
                .then(blob => {
                    // Create a URL for the encrypted image
                    const imageUrl = URL.createObjectURL(blob);

                    // Update the result preview
                    const resultImagePreview = document.getElementById('result-image-preview');
                    const resultImagePlaceholder = document.getElementById('result-image-placeholder');

                    resultImagePreview.src = imageUrl;
                    resultImagePreview.classList.remove('hidden');
                    resultImagePlaceholder.classList.add('hidden');

                    // Show download button
                    const downloadBtn = document.getElementById('download-result-btn');
                    downloadBtn.classList.remove('hidden');

                    // Set up download functionality
                    downloadBtn.onclick = function() {
                        const a = document.createElement('a');
                        a.href = imageUrl;
                        a.download = 'encrypted_image.png';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    };
                })
                .catch(error => {
                    alert(`Error: ${error.message}`);
                    console.error('Encryption error:', error);
                })
                .finally(() => {
                    // Hide loading overlay
                    hideLoadingOverlay();
                });
            });

            // Set up image decrypt button
            document.getElementById('image-decrypt-btn').addEventListener('click', function() {
                const imageFile = imageInput.files[0];
                const key = document.getElementById('image-encrypt-key').value;
                const sboxId = document.getElementById('image-encrypt-sbox-select').value;

                if (!imageFile) {
                    alert('Silakan pilih gambar yang akan didekripsi.');
                    return;
                }

                if (!key) {
                    alert('Silakan masukkan kunci dekripsi.');
                    return;
                }

                if (!sboxId) {
                    alert('Silakan pilih S-box untuk dekripsi gambar.');
                    return;
                }

                // Show loading overlay
                showLoadingOverlay();

                // Create FormData for the request
                const formData = new FormData();
                formData.append('image', imageFile);
                formData.append('key', key);
                formData.append('sbox_id', sboxId);

                // Send the request to the API
                fetch('/api/image/decrypt', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (response.ok) {
                        return response.blob();
                    } else {
                        return response.json().then(data => {
                            throw new Error(data.error || 'Unknown error occurred');
                        });
                    }
                })
                .then(blob => {
                    // Create a URL for the decrypted image
                    const imageUrl = URL.createObjectURL(blob);

                    // Update the result preview
                    const resultImagePreview = document.getElementById('result-image-preview');
                    const resultImagePlaceholder = document.getElementById('result-image-placeholder');

                    resultImagePreview.src = imageUrl;
                    resultImagePreview.classList.remove('hidden');
                    resultImagePlaceholder.classList.add('hidden');

                    // Show download button
                    const downloadBtn = document.getElementById('download-result-btn');
                    downloadBtn.classList.remove('hidden');

                    // Set up download functionality
                    downloadBtn.onclick = function() {
                        const a = document.createElement('a');
                        a.href = imageUrl;
                        a.download = 'decrypted_image.png';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    };
                })
                .catch(error => {
                    alert(`Error: ${error.message}`);
                    console.error('Decryption error:', error);
                })
                .finally(() => {
                    // Hide loading overlay
                    hideLoadingOverlay();
                });
            });
        });
    </script>
</body>
</html>